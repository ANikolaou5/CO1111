<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <title>Leaderboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/leaderboard.css">
</head>

<body>
<img src="wallpaper1.jpeg"  id="leaderboardBackground" alt="">
    <h2 id="leaderboardTitle">
        <span id="leaderboardSpan">
            <img src="Star.png"  class="star" alt="">
            Leaderboard
            <img src="Star.png"  class="star" alt="">
        </span>
    </h2>
    <div id="leaderBoardDiv">
        <table id="leaderboardTable">
            <tr>
                <th><span class="tab1"></span>Name</th>
                <th>Score</th>
                <th>Time</th>
            </tr>
        </table>
        <br>
    </div>

<script>
    let sessionId = new URLSearchParams(location.search).get("session");

    function handleLeaderboard(leaderboard) {
        let html = "";
        let leaderboardArray = leaderboard['leaderboard'];
        let index= 1;
        for (const entry of leaderboardArray) {
            var time = Math.round(entry['completionTime'] / 60000);
            html += "<tr>" +
                "<td>" + index + ".  " + entry['player'] + "</td>" +
                "<td>" + entry['score'] + "</td>" +
                "<td>" + time + " minutes" + "</td>" +
                "</tr>";
            index++;
        }
        let leaderboardElement = document.getElementById('leaderboardTable');
        leaderboardElement.innerHTML += html;
    }

    function getLeaderBoard() {
        fetch(`https://codecyprus.org/th/api/leaderboard?session=${sessionId}`)
            .then(response => response.json())
            .then(json => handleLeaderboard(json));
    }

    getLeaderBoard();
</script>
</body>
</html>
